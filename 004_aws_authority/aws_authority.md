# ã¾ã¨ã‚

## IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ IAMãƒ­ãƒ¼ãƒ«ã€IAMãƒãƒªã‚·ãƒ¼ã«ã¤ã„ã¦ç†è§£ã™ã‚‹

### IAMãƒ¦ãƒ¼ã‚¶ãƒ¼

* AWSã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã“ã¨
* æ°¸ç¶šçš„ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®è³‡æ ¼æƒ…å ±ã‚’æŒã¤
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒAWSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚„APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ä½¿ç”¨ã•ã‚Œã‚‹

### IAMãƒ­ãƒ¼ãƒ«

* AWSãƒªã‚½ãƒ¼ã‚¹ã«ä¸€æ™‚çš„ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ãŸã‚ã®ã‚‚ã®
* IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç•°ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®æ°¸ç¶šçš„ãªè³‡æ ¼æƒ…å ±ã‚’æŒãŸãªã„
  * ä»£ã‚ã‚Šã«ã€å¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä¸€æ™‚çš„ã«ä½¿ç”¨ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã‚‹

### IAMãƒãƒªã‚·ãƒ¼

* AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å®šç¾©ã—ãŸã‚‚ã®
* IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã€IAMãƒ­ãƒ¼ãƒ«ã€IAMã‚°ãƒ«ãƒ¼ãƒ—ã«é–¢é€£ä»˜ã‘ã—ã¦ä½¿ç”¨ã™ã‚‹
* è¤‡æ•°ã®ãƒãƒªã‚·ãƒ¼ã‚’æ„å‘³ã®ã‚ã‚‹å˜ä½ã§ã¾ã¨ã‚ãŸã‚‚ã®ãŒIAMãƒ­ãƒ¼ãƒ«ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã‚‹
  * ãƒãƒªã‚·ãƒ¼ã‚’ä¸€ã¤ã‚‚æŒãŸãªã„IAMãƒ­ãƒ¼ãƒ«ã¯ä½•ã®æ¨©é™ã‚‚æŒãŸãªã„ãŸã‚ã€å®Ÿè³ªçš„ã«ã¯æ„å‘³ãŒãªã„

## IAMãƒãƒªã‚·ãƒ¼ã®JSON ãƒãƒªã‚·ãƒ¼

ä¸‹è¨˜ã®ä¾‹ãŒå®šç¾©ã—ã¦ã„ã‚‹ã“ã¨ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€

* bucket-for-ec2ã¨ã„ã†S3ãƒã‚±ãƒƒãƒˆã¨ãã®ä¸­ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã™ã‚‹(Resource)
* æ›¸ãè¾¼ã¿ã€èª­ã¿å–ã‚Šã€ä¸€è¦§è¡¨ç¤ºã¨ã„ã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’(Action)
* è¨±å¯ã™ã‚‹(Effect)

ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::bucket-for-ec2/*",
                "arn:aws:s3:::bucket-for-ec2"
            ]
        }
    ]
}
```

### Effect

æ¬¡ã®é …ç›®ä»¥é™ã§æŒ‡å®šã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’"è¨±å¯ã™ã‚‹(Allow)"ã®ã‹"æ‹’å¦ã™ã‚‹(Deny)"ã®ã‹ã‚’æŒ‡å®šã™ã‚‹é …ç›®

### Action

AWSã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒªã‚¹ãƒˆã€‚
ä¾‹ãˆã°ã€

* ec2:RunInstances: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã€‚
* ec2:DescribeSecurityGroups: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã€‚
* s3:ListBucket: S3ãƒã‚±ãƒƒãƒˆã®ä¸€è¦§è¡¨ç¤ºã‚’ã™ã‚‹

ãªã©ç„¡æ•°ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã€‚

### Resource

ã“ã“ã§å®šç¾©ã™ã‚‹ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã‚‹AWSãƒªã‚½ãƒ¼ã‚¹(Amazon Resource Name)ã®ãƒªã‚¹ãƒˆã€‚
ä»Šå›ã®ä¾‹ã ã¨ã€æ›¸ãè¾¼ã¿ã€èª­ã¿å–ã‚Šã€ä¸€è¦§è¡¨ç¤ºãŒè¨±å¯ã•ã‚Œã‚‹å…ˆã®S3ãƒã‚±ãƒƒãƒˆã¨S3ãƒã‚±ãƒƒãƒˆå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã€‚

## IAMãƒ­ãƒ¼ãƒ«ã®Assume Role

IAMã«é–¢é€£ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®1ã¤ã§ã€AWSãƒªã‚½ãƒ¼ã‚¹(EC2ã‚„Lamdaãªã©)ãŒç‰¹å®šã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä¸€æ™‚çš„ã«å¼•ãå—ã‘ã‚‹(assume)ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚EC2ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã€IAMãƒ­ãƒ¼ãƒ«ã‚’Assumeã™ã‚‹ã“ã¨ã§ã€ãƒ­ãƒ¼ãƒ«ã«ç´ã¥ãæ¨©é™ã‚’å–å¾—ã§ãã‚‹ã€‚

### ä¿¡é ¼ãƒãƒªã‚·ãƒ¼

IAMãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã‚‹(assume)ã“ã¨ãŒã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’æŒ‡å®šã™ã‚‹**ä¿¡é ¼ãƒãƒªã‚·ãƒ¼**ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã€‚ã“ã‚Œã¯ã€IAMãƒ­ãƒ¼ãƒ«ã”ã¨ã«è¨­å®šã™ã‚‹ã‚‚ã®ã€‚å½“ç„¶ãªãŒã‚‰ã€ã©ã‚“ãªãƒªã‚½ãƒ¼ã‚¹ã§ã‚‚IAMãƒ­ãƒ¼ãƒ«ã‚’Assumeã§ãã¦ã—ã¾ã†ã®ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«å•é¡ŒãŒã‚ã‚‹ã®ã§ã€ã“ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ãªã‘ã‚Œã°ã“ã®IAMãƒ­ãƒ¼ãƒ«ã¯èª°ã‚‚å¼•ãå—ã‘ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚

ä¸‹è¨˜ã¯ã€ç‰¹å®šã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹(id-aaaaaaabbbbbccccc)ã®ã¿ãŒIAMãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ãŸä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã€‚

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "ec2.amazonaws.com"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "ec2:InstanceID": "id-aaaaaaabbbbbccccc"
        }
      }
    }
  ]
}
```

# æ§‹ç¯‰æ‰‹é †

## S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹

### S3ãƒã‚±ãƒƒãƒˆã¨ã¯

S3ãƒã‚±ãƒƒãƒˆã¯ã€Amazon S3(Simple Storage Service)ä¸Šã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠã®ã“ã¨ã§ã™ã€‚S3ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ãƒ¼ã‚¿ã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒã‚±ãƒƒãƒˆå†…ã«ä¿å­˜ã§ãã¾ã™ã€‚ãƒã‚±ãƒƒãƒˆã¯ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

Azureã§è¨€ã†ã¨ã€Blob Storageã‚µãƒ¼ãƒ“ã‚¹ã«è©²å½“ã—ã¾ã™ã€‚

### ä½œæˆæ‰‹é †

Amazon S3ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€Œãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã€ã‚’é¸æŠã—ã¾ã™ã€‚

* ä¸€èˆ¬çš„ãªè¨­å®š
  * **ãƒã‚±ãƒƒãƒˆå**: bucket-for-ec2
  * **AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ã‚¢ã‚¸ã‚¢ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ï¼ˆæ±äº¬ï¼‰ap-northeast-1
* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ‰€æœ‰è€…
  * ACLç„¡åŠ¹(æ¨å¥¨)ã«âœ…
* ã“ã®ãƒã‚±ãƒƒãƒˆã®ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š
  * ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…¨ã¦ãƒ–ãƒ­ãƒƒã‚¯ã«âœ…
* ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
  * **ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: ç„¡åŠ¹ã«ã™ã‚‹ã«âœ…
* ğŸŒŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æš—å·åŒ–
  * **æš—å·åŒ–ã‚¿ã‚¤ãƒ—**: Amazon S3 ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼å´ã®æš—å·åŒ– (SSE-S3)
  * **ãƒã‚±ãƒƒãƒˆã‚­ãƒ¼**: æœ‰åŠ¹ã«ã™ã‚‹

ã€Œãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚

#### æš—å·åŒ–ã®ã‚¿ã‚¤ãƒ—

æš—å·åŒ–ã®ã‚¿ã‚¤ãƒ—ã®é …ç›®ã§ã€**(SSE-S3)**ã¨**SSE-KMS**ãŒé¸æŠã§ãã¾ã™ã€‚SSE-S3ã¯ã€AmazonS3å´ã§ã‚­ãƒ¼ã®ç®¡ç†ã‚’è¡Œãªã£ã¦ãã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚ä¸€æ–¹ã§ã€SSE-KMSã¯ã€AWSã®ã‚­ãƒ¼ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹(**KMS**)ã‚’ä½¿ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã§ã‚­ãƒ¼ã‚’ç®¡ç†ã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚

#### ğŸŒŸãƒã‚±ãƒƒãƒˆã‚­ãƒ¼ã®æœ‰åŠ¹åŒ–ãƒ»ç„¡åŠ¹åŒ–

ãƒã‚±ãƒƒãƒˆã‚­ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€**ãƒã‚±ãƒƒãƒˆå…¨ä½“ã§1ã¤ã®KMSã‚­ãƒ¼ã‚’ä½¿ç”¨**ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä¸€æ–¹ã§ã€ç„¡åŠ¹åŒ–ã™ã‚‹ã¨ã€å„S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã”ã¨ã«KMSã‚­ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒã‚±ãƒƒãƒˆã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ãŸçŠ¶æ…‹ã§å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’S3ãƒã‚±ãƒƒãƒˆã«ä¿å­˜ã™ã‚‹å ´åˆã€KMSã‚­ãƒ¼ãŒå¤§é‡ã«ä½œã‚‰ã‚Œã€KMSã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚å¤§é‡ã«ç™ºç”Ÿã—ã¾ã™ã€‚

## EC2ã‹ã‚‰S3ãƒã‚±ãƒƒãƒˆã«å¯¾ã™ã‚‹æ“ä½œã‚’è¡Œã†

ä»Šå›ã€EC2ã‹ã‚‰S3ãƒã‚±ãƒƒãƒˆã«å¯¾ã—ã¦ã€**ä¸€è¦§è¡¨ç¤ºãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»æ›¸ãè¾¼ã¿**ã®æ“ä½œãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ã€æ¬¡ã®3ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¸ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. ç‰¹å®šã®S3ãƒã‚±ãƒƒãƒˆã«ä¸€è¦§è¡¨ç¤ºãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»æ›¸ãè¾¼ã¿ã™ã‚‹æ¨©é™ã‚’æŒã¤ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹
2. IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€1ã§ä½œæˆã—ãŸãƒãƒªã‚·ãƒ¼ã‚’é–¢é€£ä»˜ã‘ã™ã‚‹
3. 2ã®IAMãƒ­ãƒ¼ãƒ«ã‚’EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é–¢é€£ä»˜ã‘ã™ã‚‹

ã“ã®æ‰‹é †ã‚’è¸ã‚€ã“ã¨ã§ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰S3ãƒã‚±ãƒƒãƒˆã¸ã®**ä¸€è¦§è¡¨ç¤ºãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»æ›¸ãè¾¼ã¿**ã®æ“ä½œãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã§ã¯ã€å®Ÿéš›ã«ã‚„ã£ã¦ã„ãã¾ã™ã€‚

### ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹

AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰IAMãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã€ãƒãƒªã‚·ãƒ¼ã‚’é¸æŠã—ã¾ã™ã€‚

* ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã‚’æŠ¼ã™
* ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æŒ‡å®š
  * **ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ**: S3ã‚’é¸æŠ
  * **ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«**: ä»¥ä¸‹ã®3ã¤ã‚’é¸æŠ
    * ãƒªã‚¹ãƒˆ: ListBucket
    * èª­ã¿å–ã‚Š: GetObject
    * æ›¸ãè¾¼ã¿: PutObject
* ãƒªã‚½ãƒ¼ã‚¹
  * ç‰¹å®šã‚’é¸æŠ
  * ARNã‚’è¿½åŠ 
    * **bucket**
      * ä»»æ„ã®bucket name: bucket-for-ec2(å…ˆã»ã©ä½œæˆã—ãŸS3ãƒã‚±ãƒƒãƒˆ)
      * ä»»æ„ã®ãƒªã‚½ãƒ¼ã‚¹: bucket-for-ec2
    * **object**
      * ä»»æ„ã®bucket name: bucket-for-ec2
      * ä»»æ„ã®object name: *ï¼ˆbucket-for-ec2ã®å…¨ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šï¼‰
* ãƒãƒªã‚·ãƒ¼å: PolicyForTestBucket

ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ã®ãƒãƒªã‚·ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

image

ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã§**ä½•ã‚’ã§ãã‚‹ã‹**ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ä¸€æ–¹ã€ãƒªã‚½ãƒ¼ã‚¹ã§ã¯**ã©ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦**ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€å…ˆã»ã©ä½œæˆã—ãŸbucket-for-ec2ã¨ã„ã†S3ãƒã‚±ãƒƒãƒˆã‚’æŒ‡å®šã—ã¾ã—ãŸã€‚ã“ã®ãƒãƒªã‚·ãƒ¼ã¯ã€**bucket-for-ec2ã¨ã„ã†S3ãƒã‚±ãƒƒãƒˆã«å¯¾ã—ã¦ã€ãƒªã‚¹ãƒˆè¡¨ç¤ºã€èª­ã¿å–ã‚Šã€æ›¸ãè¾¼ã¿ãŒã§ãã‚‹**ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

#### ãƒãƒªã‚·ãƒ¼ã‚’JSONã§ç¢ºèªã™ã‚‹

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::bucket-for-ec2/*",
                "arn:aws:s3:::bucket-for-ec2"
            ]
        }
    ]
}
```

### EC2ç”¨ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹

AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰IAMãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã€ãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚

* ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã‚’æŠ¼ã™
* ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ï¼š AWSã®ã‚µãƒ¼ãƒ“ã‚¹
* ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
  * **ã‚µãƒ¼ãƒ“ã‚¹ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: EC2
  * ğŸŒŸ**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: EC2
* è¨±å¯ã‚’è¿½åŠ 
  * è¨±å¯ãƒãƒªã‚·ãƒ¼: PolicyForTestS3Bucketï¼ˆå…ˆã»ã©ä½œæˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ã®ãƒãƒªã‚·ãƒ¼ï¼‰
* åå‰ã€ç¢ºèªã€ãŠã‚ˆã³ä½œæˆ
  * ãƒ­ãƒ¼ãƒ«å: RoleForTestS3Bucket

ãƒ­ãƒ¼ãƒ«ãŒä½œæˆã§ãã¾ã—ãŸã€‚

### EC2ãŒS3ã«å¯¾ã™ã‚‹æ¨©é™ãŒãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹

EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«SSHæ¥ç¶šã—ã¦ã€S3ãƒã‚±ãƒƒãƒˆå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€è¦§è¡¨ç¤ºã‚’è©¦ã¿ã¾ã™ã€‚

```bash
[ec2-user@ip-** ~]$ aws s3 ls s3://bucket-for-ec2
Unable to locate credentials. You can configure credentials by running "aws configure".
```

ã”è¦§ã®é€šã‚Šã€EC2ã‹ã‚‰S3ãƒã‚±ãƒƒãƒˆã‚’æ“ä½œã™ã‚‹æ¨©é™ãŒãªã„ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

### EC2ã«IAMãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹

EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒšãƒ¼ã‚¸ã«ç§»ã‚Šã¾ã™ã€‚

* IAMãƒ­ãƒ¼ãƒ«ã‚’ç´ä»˜ã‘ãŸã„EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒã‚§ãƒƒã‚¯ã‚’ä»˜ã‘ã¾ã™
* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ > IAMãƒ­ãƒ¼ãƒ«ã‚’å¤‰æ›´
* **IAMãƒ­ãƒ¼ãƒ«**: RoleForTestS3Bucketï¼ˆå…ˆã»ã©ä½œæˆã—ãŸIAMãƒ­ãƒ¼ãƒ«ï¼‰

IAMãƒ­ãƒ¼ãƒ«ã®æ›´æ–°ã‚’æŠ¼ã—ã¾ã™ã€‚

EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ãƒšãƒ¼ã‚¸ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¿ãƒ–ã‹ã‚‰é–¢é€£ä»˜ã‘ã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ãŒç¢ºèªã§ãã¾ã™ã€‚

image

## ï¼ˆä»®ï¼‰EC2ã‹ã‚‰S3ã¸ã®æ“ä½œã‚’è¡Œã†

ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€S3ãƒã‚±ãƒƒãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
[ec2-user@ip-** ~]$ touch test.txt
[ec2-user@ip-** ~]$ aws s3 cp test.txt s3://bucket-for-ec2/documents/test.txt
upload: ./test.txt to s3://bucket-for-ec2/documents/test.txt
```

ç¶šã„ã¦ã€ä¸€è¦§è¡¨ç¤ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
[ec2-user@ip-** ~]$ aws s3 ls s3://bucket-for-ec2
[ec2-user@ip-** ~]$ aws s3 ls s3://bucket-for-ec2/documents/
2023-09-23 02:34:44          0 test.txt
```

å…ˆã»ã©ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

æœ€å¾Œã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```bash
[ec2-user@ip-** ~]$ aws s3 cp s3://bucket-for-ec2/documents/test.txt test_downloaded.txt
download: s3://bucket-for-ec2/documents/test.txt to ./test_downloaded.txt
[ec2-user@ip-** ~]$ ls
test.txt  test_downloaded.txt
```

S3ãƒã‚±ãƒƒãƒˆã«ã‚ã‚‹`test.txt`ã‚’EC2ãƒ­ãƒ¼ã‚«ãƒ«ã«`test_downloaded.txt`ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚
